\chapter{Finite Differenzen der stationären Gleichung}
Im folgendem Kapitel soll die stationäre Verteilung der Ladungsträger bei kontinuierlicher Bestrahlung modelliert werden. 
Dadurch kann die zeitliche Abhängigkeit vernachlässige werden ($\frac{\partial u}{\partial t}=0$)
 
Die allgemeine DGL ist gegeben durch:
\begin{equation}
	\frac{\partial u}{\partial t}= D\cdot\frac{\partial ^2 u }{\partial z^2}-(k1+k2\cdot N_D)\cdot u -k2u^2 +s(t,z)
\end{equation}

\begin{conditions}
	s(t,z)     &  Ladungsträgerdichte durch Bestrahlung \\
	D     &  Diffusionskonstante \\   
	N_D &  Dotierungsdichte \\
	k1,k2 &  Rekombinationskonstanten \\
	\alpha & Absorptionskonstante\\
	S_L,S_R  & Rekombinationsraten an den jeweiligen Grenzschichten
\end{conditions}

Mit $\frac{\partial u}{\partial t}=0$ folgt die stationäre Gleichung:

\begin{equation}\label{eq:stationDGL}
	D\cdot \pdv[2]{u}{z} -\left( k_1 +k_2 N_D\right)\cdot u-k_2\cdot u^2=-s(z), \quad 0 <z<d
\end{equation}

mit den Randbedingungen:

\begin{equation}\label{eq:randbedingungen}
	D\cdot \frac{\partial u}{\partial z}(0)=S_Lu(0),\quad D\frac{\partial u}{\partial z}(d)=-S_Ru(d)
\end{equation}

\section{Lineare stationäre Gleichung}
Im Folgendem Kapitel soll nur der in u lineare Anteil der stationären, zeitunabhängigen Gleichung (Eq. \ref{eq:stationDGL}) ohne den quadratischen Term $-k_2u^2$ behandelt werden\cite{Prof.Dr.AndreasZeiser.April2021}.

 
 \begin{mybox}
 	\textbf{Aufgabe 1.} Erarbeiten Sie sich Abschnitt 8.8 aus \cite{Atkinson.2004} und beschreiben Sie Ihr Vorgehen für die Anwendung der Methode auf Gleichung.\cite{Prof.Dr.AndreasZeiser.April2021} 
 \end{mybox}

	Mit der Methode der finiten Differenzen für Zweipunkt-Grenzwertprobleme, beschrieben in \cite[p. 442]{Atkinson.2004}, können lineare Differenzialgleichungen zweiter Ordnung gelöst werden. Es werden dabei die Ableitungen der Gleichung durch finite Differenzen substituiert, um eine diskretisierte Gleichung zu erhalten.
	Als Ergebnis erhält man eine Matrix, mit der sich die zeitabhängige Stelle der Leitungsträgerdichte $u_i$ mathematisch beschreiben lassen. 
	
	Für diese Methode sind drei Schritte notwendig:
	\begin{enumerate}
		\item Diskretisierung eines Bereiches ($z\in [0,d]$) der Funktion in $M$ gleich große Intervalle der Länge $h=\frac{(d-0)}{N}$ (\cref{fig:bsp_knotenpunkte})
		\item Diskretisierung der Differenzialgleichung an den Knotenpunkten mit Approximation der Ableitung (\cref{eq:approx_first_order,eq:approx_second_order})
		\item Diskretisierung der Randbedingung und Aufstellung eines Gleichungssystemes durch Eliminierung von $u_{-1}$ und $u_{N+1}$
	\end{enumerate}

 \begin{mybox}
	\textbf{Aufgabe 2.} Leiten Sie analog zu Gleichung (8.128) die Gleichungen für die gesuchten Werte  $u_0, u_1, \dots , u_N$ an den Punkten $z_0,\dots, z_N$ her. Die Gleichungen enthalten $u_1$ und $u_\mathrm{N+1}$, die im nächsten Schritt eliminiert werden. Verwenden Sie dabei die Abkürzung $ s_i = s(z_i)$.\cite{Prof.Dr.AndreasZeiser.April2021} 
\end{mybox}
	
 
 \begin{figure}[htb]
 	\centering
 	 \begin{tikzpicture}
 		\begin{axis}[
 			axis x line = middle,
 			axis y line = middle,
 			 xmin=-1,
 			xmax=5,
 			ymin=-5,
 			ymax=20,
 			xtick={-1,0,1,2,3,4,5},
 			ytick={-5,0,5,10,15,20},
 			xticklabels={$z_{-1}$,$z_0$,$z_1$,$z_2$,$z_3$,$z_N$}
 			]
 			\addplot[domain=-1:5]{x^2-x+10};
 			\draw [dashed] (axis cs:1,1^2-1+10) -- (axis cs:1,0);
 			\draw [dashed] (axis cs:2,2^2-2+10) -- (axis cs:2,0);
 			
 			\draw [thick,decoration={brace,mirror,raise=2pt},decorate] 
 			(axis cs:1,0) --
 			node[below=7pt] {$h$} 
 			(axis cs:2,0);
		\end{axis}
 	\end{tikzpicture}
\caption{Beispieldarstellung: Knotenpunkte mit Schrittweite $h$}
\label{fig:bsp_knotenpunkte}
 \end{figure}

Stationäre Differenzialgleichung(\cref{eq:stationDGL}) ohne den quadratischen Term $-k^2u^2$:
\begin{equation}\label{eq:linearDGL}
	D \pdv[2]{u}{z} -ku=-s(z), \quad 0 <z<d
\end{equation}
mit $k=k_1+k_2\cdot N_D$.

\begin{align*}
	k&=k_1+k_2*N_D\\
	s_i&= s(z_i)\\
	u_i&\approx u(z_i)
\end{align*}
\begin{conditions}
	u_i & Approximierte Ladungsträgerdichte an den Stellen $z_i$ \\
	s_i & Ladungsträgerdichte die durch externe Bestrahlung an den Stellen $z_i$ erzeugt wird
\end{conditions}

Approximation der Ableitung erster Ordnung:
\begin{equation}\label{eq:approx_first_order}
	\frac{\partial u}{\partial z} = \frac{u_{i+1} - u_{i-1}}{2h}
\end{equation}
Approximation der Ableitung zweiter Ordnung:
\begin{equation}\label{eq:approx_second_order}
	\frac{\partial ^2 u }{\partial z^2} = \frac{u_{i+1} - 2\cdot u_i + u_{i-1}}{h^2} \quad i=1,2,\dots,N
\end{equation}

Durch Einsetzen von \cref{eq:approx_second_order} in \cref{eq:linearDGL} erhält man:
\begin{equation}\label{eq:stationare_approx}
	D\cdot\frac{u_{i+1} - 2\cdot u_i + u_{i-1}}{h^2} -k\cdot u_i = -s_i
\end{equation}

\begin{qed}
Nun wird nach der Variable $u_i$ sortiert und folgende Gleichung aufgestellt:
\begin{equation}
	\frac{D}{h^2}\cdot u_{i-1} - \frac{2D+kh^2}{h^2}\cdot u_i + \frac{D}{h^2}\cdot u_{i+1} = -s_i
\end{equation}
\end{qed}


\begin{mybox}
	\textbf{Aufgabe 3.}	Approximieren Sie die ersten Ableitungen an den Randbedingungen:
	
	\begin{equation}
	 \tcbhighmath{	D\cdot \frac{\partial u}{\partial z}(0)=S_Lu(0),\quad D\frac{\partial u}{\partial z}(d)=-S_Ru(d)}
	\end{equation}
	durch:
	
	\begin{equation}
	 \tcbhighmath{	u'(0) \approx \frac{u_1-u_{-1}}{2h}, \quad u'(d) \approx \frac{u_{N+1}-u_{N-1}}{2h}}
	\end{equation}
	
	und lösen Sie die Gleichungen nach $u_1$ bzw. $u_N+1$ auf. Setzen Sie diese Ausdrücke in die Gleichungen für die Knoten $z_0$ und $z_N$ der letzten Teilaufgabe ein.
\end{mybox}



Erste Randbedingung:

\begin{equation}
	D\cdot \frac{\partial u}{\partial z}(0)=S_Lu(0)
\end{equation}

\begin{equation}
	\frac{\partial u(0)}{\partial z}=\frac{S_Lu(0)}{D}
\end{equation}
Mit der Approximation der Ableitung erster Ordnung (\cref{eq:approx_first_order}):
\begin{equation}
	\frac{S_Lu_0}{D} = \frac{u_1-u_{-1}}{2h}
\end{equation}

\begin{equation}
	u_0 = D\cdot \frac{u_1-u_{-1}}{2h\cdot S_\mathrm{L}}
\end{equation}

\begin{equation}
	u_0 = \frac{D}{2h\cdot S_L} \cdot u_1 - \frac{D}{2h\cdot S_L} \cdot u_{-1}
\end{equation}

\begin{qed}
	\textbf{Damit folgt für $u_{-1}$:}
	\begin{equation}\label{eq:rand_u-1}
		u_{\text{-}1} = u_1 - \frac{2h\cdot S_L}{D} \cdot u_0
	\end{equation}
\end{qed}


Zweite Randbedingungen:

\begin{equation}
	D\frac{\partial u}{\partial z}(d)=-S_Ru(d)
\end{equation}

\begin{equation}
	\frac{\partial u}{\partial z}(d)=-S_Ru(d)/D
\end{equation}
Durch Approximation der Randbedingung folgt:
\begin{equation}
	\frac{-S_R}{D}\cdot u_\mathrm{N} = \frac{u_{\mathrm{N}+1}-u_{\mathrm{N}-1}}{2h}
\end{equation}

\begin{equation}
	u_\mathrm{N} = D\cdot \frac{u_{N+1}-u_{N-1}}{-2hS_R}
\end{equation}

\begin{equation}
	u_\mathrm{N} = \frac{D}{-2hS_R} \cdot u_{N+1} - \frac{D}{-2hS_R} \cdot u_{\mathrm{N}-1}
\end{equation}


\begin{qed}
	\textbf{Damit folgt für $u_{\mathrm{N}+1}$}:
	\begin{equation}\label{eq:approx_RN}
		u_{N+1} =u_{\mathrm{N}-1} -\frac{2\cdot h\cdot S_R}{D} \cdot u_\mathrm{N} 
	\end{equation}
\end{qed}


Im folgendem werden die Approximationen der Randbedingungen in die stationäre, diskretisierte DGL (\cref{eq:stationare_approx}) eingesetzt. Dazu wird die Diskretisierung zunächst an die Randbedingungen angepasst:
\begin{equation}
	\begin{split}
		Z_N&: \quad	D\cdot \frac{u_{N+1}-2u_\mathrm{N}+u_{N-1}}{h^2}-ku_N=-s_N \\
		Z_0&: \quad D\cdot \frac{u_{1}-2u_0+u_{-1}}{h^2}-ku_0=-s_0
	\end{split}
\end{equation}
mit der Approximation der Randbedingung \cref{eq:approx_RN,eq:rand_u-1} folgt:

	\begin{equation}
		\begin{split}
				Z_N: \quad	D\cdot \frac{u_{\mathrm{N}-1}-\frac{2\cdot h\cdot S_R}{D} \cdot u_\mathrm{N}  -2u_\mathrm{N}+u_{\mathrm{N}-1}}{h^2}-ku_N=-s_N \\
					\frac{-2hS_R-2D}{h^2}\cdot u_\mathrm{N}+\frac{2D}{h^2}\cdot u_{N-1}-ku_\mathrm{N}=-s_\mathrm{N}\\
						\frac{2D}{h^2}\cdot u_{N-1}-\frac{2hS_R+2D+kh^2}{h^2}\cdot u_\mathrm{N}=-s_\mathrm{N}
		\end{split}
	\end{equation}

	\begin{equation}
	\begin{split}
		Z_0: \quad	D\cdot \frac{u_1-2u_0+u_1-\frac{2\cdot h\cdot S_L}{D} \cdot u_0 }{h^2}-ku_0=-s_0\\
		\frac{2D}{h^2}\cdot u_1 - \frac{2D+2h\cdot S_\mathrm{L}+kh^2}{h^2}\cdot u_0=-S_0
	\end{split}
\end{equation}

\begin{qed}
		Es ergibt sich der Wert für $Z_0$ damit zu:
	\begin{equation}
		\tcbhighmath{Z_0: \quad \frac{2D}{h^2}\cdot u_1 - \frac{2D+2h\cdot S_\mathrm{L}+kh^2}{h^2}\cdot u_0=-s_0}
	\end{equation}
	Es ergibt sich der Wert für $Z_\mathrm{N}$ damit zu:
	\begin{equation}
	\tcbhighmath{Z_N: \quad	\frac{2D}{h^2}\cdot u_{N-1}-\frac{2hS_R+2D+kh^2}{h^2}\cdot u_\mathrm{N}=-s_\mathrm{N}}
	\end{equation}

\end{qed}



\begin{mybox}
	\textbf{Aufgabe 4.} Stellen Sie das lineare Gleichungssystem für die Größen analog zu Gleichung (8.133) in \cite{Atkinson.2004} und folgende dar:
	\begin{equation}\label{eq:lgs}
		\mathbf{A} u = \mathbf{b},\quad \mathbf{u} = [u_i],\quad \mathbf{b} = [b_i]
	\end{equation}

	Ordnen Sie die Gleichungen analog zu den Knotenpunkten.
\end{mybox}




Mit Hilfe der Matrixform $\mathbf{A} u =\mathbf{ b} $ lässt sich dieses Gleichungssystem mit Hilfe von Matlab lösen. Dazu wird die Koeffizientenmatrix

\begin{equation}
\mathbf{A}=	\begin{bmatrix}
		-\frac{2hS_\mathrm{L}+2D+kh^2}{h^2} & \frac{2D}{h^2} & & &  &   \\
		\frac{D}{h^2} & - \frac{2D+kh^2}{h^2} & \frac{D}{h^2} &  &  & \\
	\ddots	&  \ddots &  \ddots &  \ddots &  &  \\
		& \ddots & \ddots & \ddots & \ddots  & \ddots \\
		&  &  & \frac{D}{h^2} & - \frac{2D+kh^2}{h^2} & \frac{D}{h^2} \\
		&  &  &  & \frac{2D}{h^2} & -\frac{2hS_R+2D+kh^2}{h^2}
	\end{bmatrix}
\end{equation}
sowie die recht Seite $\mathbf{b}$ und der gesucht Vektor $\mathbf{u}$
\begin{equation}
	\vec{b}=-\vec{s}_\mathrm{i}\quad,	\vec{u}=-\vec{u}_\mathrm{i} \quad i=0,1,\dots,N
\end{equation}

\begin{equation}
	\mathbf{b}=\begin{bmatrix}
	-	s_0 \\
	-	s_1 \\
		\vdots \\
	-	s_{\mathrm{N}-1} \\
	-	s_{\mathrm{N}} \\
	\end{bmatrix} \quad \mathbf{u}=\begin{bmatrix}
		u_0 \\
		u_1 \\
		\vdots \\
		u_{\mathrm{N}-1} \\
		u_\mathrm{N}
	\end{bmatrix}
\end{equation}
bestimmt.
\pagebreak
\begin{mybox}
	\textbf{Aufgabe 5. :} Implementieren Sie eine Routine zur Berechnung der Matrix A der letzten Teilaufgabe. Verwenden
	Sie dabei dünnbesetzte Matrizen (sparse matrix, siehe z.B. spdiags).
\end{mybox}
\begin{figure}[htb]
	\lstinputlisting[style=Matlab-editor]{code/fd_lin_matrix.m}
\end{figure}
\clearpage
\begin{mybox}
	\textbf{Aufgabe 6. :} 
	Implementieren Sie eine Routine zur Lösung des entsprechenden Gleichungssystems \cref{eq:lgs} unter Verwendung
\verb*|fd_lin_matrix|. Lösen Sie das lineare Gleichungssystem mithilfe des Operators \textbackslash .
\end{mybox}

\begin{figure}[htb]
	\lstinputlisting[style=Matlab-editor]{code/stationaer_lin.m}
	\end{figure}
\section{Nicht Lineare stationäre Gleichung}
\begin{mybox}
	Im zweiten Schritt soll nun die volle nichtlineare \cref{eq:stationDGL} mit Randbedingung \cref{eq:randbedingungen} gelöst werden. Analog
	zum letzten Abschnitt wird ein nichtlineares Gleichungssystem aufgestellt, das mithilfe des Newton-
	Verfahrens aus der Belegarbeit gelöst werden soll. Gehen Sie wie folgt vor.\cite{Prof.Dr.AndreasZeiser.April2021}
\end{mybox}

\begin{mybox}
	\textbf{Aufgabe 1. :} Leiten Sie die nichtlinearen Gleichungen für die gesuchten Werte $u_0,u_1,\dots ,uN$ her und stellen Sie
	sie in Form
	\begin{equation*}
		\tcbhighmath{\mathbf{F}(\mathbf{u})=\mathbf{b}}
	\end{equation*}
dar. Berücksichtigen Sie die Randbedingungen wie im letzten Abschnitt.
\cite{Prof.Dr.AndreasZeiser.April2021}
\end{mybox}
Nichtlineare DGL:
\begin{equation}
	D\pdv[2]{u}{z}-(k_1+k_2N_D)u-k_2u^2=-s(z)
\end{equation}

Diskretisierung der DGL:

\begin{equation}
	D\frac{u_{i+1}-2u_i+u_{i-1}}{h^2}-k\cdot u_i-k_2 \cdot u_i^2=z_i
\end{equation}

Mit den Randbedingung:

\begin{equation}
	D\cdot \frac{\partial u}{\partial z}(0)=S_Lu(0),\quad D\frac{\partial u}{\partial z}(d)=-S_Ru(d)
\end{equation}

Und den Approximationen der ersten Ableitung der  Randbedingungen:
\begin{equation}
	u'(0)\approx \frac{u_1-u_{-1}}{2h} \quad u'(d)\approx \frac{u_{N+1}-u_{N-1}}{2h}
\end{equation}
Damit folgt für die Randbedingung:
\begin{equation}
	D\cdot \frac{u_1-u_{-1}}{2h}=S_Lu_0,\quad D\frac{u_{N+1}-u_{N-1}}{2h}=-S_Ru_N
\end{equation}
umgestellt nach $u_{-1}$
\begin{equation}
	u_{-1}=-\frac{S_L 2h}{D}\cdot u_0+u_1
\end{equation}
umgestellt nach $u_{N+1}$
\begin{equation}
	u_{N+1}=-\frac{S_R2h}{D}\cdot u_N+u_{N-1}
\end{equation}



Damit folgt für die Funktion $\mathbf{F}(\mathbf{u})=\mathbf{b}$:

\begin{align*}
	F_0&= \quad \frac{D}{h^2}u_1-\frac{2D+kh^2}{h^2}u_0+\frac{D}{h^2}\cdot\left( -\frac{S_L 2h}{D}\cdot u_0+u_1\right) -k_2u_0^2\\
	\vdots \\
	F_i&= 	\frac{D}{h^2}u_{i+1}-\frac{2D+kh^2}{h^2}u_i+\frac{D}{h^2}\cdot u_{i-1} -k_2u_i^2\\
	\vdots \\
	F_N &= \frac{D}{h^2}\left( -\frac{S_R2h}{D}\cdot u_N+u_{N-1}\right) -\frac{2D+kh^2}{h^2}u_N+\frac{D}{h^2} u_{N-1}-k_2u^2_N\\
\end{align*}

\begin{qed}
	Vereinfacht zu :
	
	\begin{align*}
		F_0&= \quad 2\cdot \frac{D}{h^2}u_1-\left( \frac{S_L2h+2D+kh^2}{h^2}\right) u_0 -k_2u_0^2\\
		\vdots \\
		F_i&= 	\frac{D}{h^2}u_{i+1}-\frac{2D+kh^2}{h^2}u_i+\frac{D}{h^2}\cdot u_{i-1} -k_2u_i^2\\
		\vdots \\
		F_N &= -\frac{2D+kh^2+S_R2h}{h^2}u_N+2\frac{D}{h^2}u_{N-1}-k_2u^2_N\\
	\end{align*}
\end{qed}

\begin{mybox}
	\textbf{Aufgabe 2. :} Implementieren Sie eine Routine zur Berechnung von $\mathbf{F}$ der letzten Teilaufgabe.\cite{Prof.Dr.AndreasZeiser.April2021}
\end{mybox}

\begin{lstlisting}[style=Matlab-editor]
	function [F] = fd_nonlin(u,N)
	% Eingabe:
	%   u Vektor u der Groeße (N + 1)
	%   N Anzahl von Teilintervallen N.
	% Ausgabe:
	%   F Vektor F(u) der Groeße (N + 1) 
	D=0.003;
	h=1;
	Sl=10;
	Sr=10e5;
	k=11e6;
	k2=10e-8;
	u0=u(1);
	u1=u(2);
	un=u(N);
	
	F(1)=2*D/h^2*u1-((Sl*2*h+2*D+k*h^2)/(h^2))*u0-k2*u0^2;
	F(N+1)=-(2*D+k*h^2+Sr*2*h)/(h^2)*un+2*(D)/(h^2)*u(N-1)-k2*un^2;
	for i=2:N
	F(i)=D/h^2*u(i+1)-(2*D+k*h^2)/(h^2)*u(i)+D/h^2*u(i-1)-k2*u(i)^2;
	end
	end
	
\end{lstlisting}

\begin{mybox}
	\textbf{Aufgabe 3. :} Berechnen Sie die Jacobi-Matrix $D\mathbf{F}$ von $\mathbf{F}$ bezüglich u und geben Sie sie an
\end{mybox}
\begin{equation}
	\begin{bmatrix}
		\pdv{F_0}{U_0} & \pdv{F_0}{U_0}  \\
		
	\end{bmatrix}
\end{equation}

\begin{equation}
	\begin{bmatrix}
		\pdv{F_0}{U_0} & \pdv{F_0}{U_0}  \\
		
	\end{bmatrix}
\end{equation}

\begin{equation}
	\begin{bmatrix}
		\pdv{F_0}{U_0} & \pdv{F_0}{U_0}  \\
		
	\end{bmatrix}
\end{equation}



