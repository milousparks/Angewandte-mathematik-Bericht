\chapter{Implizite Einschrittverfahren}

Steife Systeme treten aber auch in der Modellierung von Reaktionen in der Chemie auf. Als Beispiel soll
eine chemische Reaktion dreier Stoffe $A;B;C$ aus [3] dienen:

\begin{equation*}
	A \rightarrow B, \quad B + B \rightarrow C+ B, \quad B + C \rightarrow A + C
\end{equation*}. 

Die Dynamik der Konzentrationen der einzelnen Komponenten können durch Anfangswertproblem
\begin{align}\label{eq:matrix}
	A:y'_1&= &{}-0.04\cdot y_1  &{}+ 10^4\cdot y_2y_3& & &\\
	B:y'_2&= & 0.04\cdot y_1  &{}- 10^4\cdot y_2y_3& &{}- 3\cdot 10^7y_2^2 &\\
	C:y'_3&= &                  &                  &  & 3\cdot 10^7y_2^2 &\\
\end{align}



%\begin{align*}
%	A: y'_1 = -0.04y_1 + 10^4y_2y_2\\
%	B: y'_2 =  0.04y_1 - 10^4y_2y_3\cdot - 3\cdot 10^7y^2_2
%	C: y'_3 =                              3\cdot 10^7y^2_2
% \end{align*}

mit den Anfangswerten

\begin{equation*}
y_1(0) = 1, y_2(0) = 0, y_3(0) = 0
\end{equation*}  

modelliert werden. Anhand dieses Systems sollen im folgenden steife Differenzialgleichungen untersucht
und ein effizientes numerisches Verfahren entwickelt werden.

\section{Entwicklung}

Ein allgemeines System von Anfangswertproblemen für eine Funktion y kann als folgendes geschrieben werden:
\begin{equation}
	 y' = f(t,y) ,\quad t \in [a,b],\quad y(a) = y_a 
\end{equation}



Der Wert von y wird näherungsweise an den Zeitpunkten berechnet:
\begin{equation}
	 y^i \approx y(t_i),\quad i = 0,1,\dots,N 
\end{equation}


Das implizite Euler-Verfahren:
\begin{equation}
	 y^{(i+1)} = y^{(i)} + hf(t_{i+1},y^{(i+1)}) 
\end{equation}


Die implizite Trapezregel:
\begin{equation}
	y^{(i+1)} = y^{(i)} + \frac{h}{2}\left[f\left(t_i, y^{(i)} + f(t_{i+1},y^{(i+1)})\right)\right] 
\end{equation}

\begin{mybox}
\textbf{Aufgabe 1.}	
	Erarbeiten Sie sich Abschnitt 8.4 aus \cite{Atkinson.2004} und fassen Sie in eigenen Worten zusammen, was Sie unter steifen Differenzialgleichung verstehen.
	Unter einer starren Differenzialgleichung versteht man eine Gleichung mit bestimmten numerischen Methoden, die besonders große Störungsfaktoren am Ausgang aufweisen, sofern die Schrittweite nicht allzu klein ausgewählt wird.
\end{mybox}



\begin{mybox}
	\textbf{Aufgabe 2:}
	Setzen Sie in den Gleichungen des impliziten Euler-Verfahrens und der impliziten Trapezregel
	\begin{equation*}
	\tcbhighmath{\mathbf{y}^{i+1} = \mathbf{y}(i) + \mathbf{z}}  
	\end{equation*}
	
	und formulieren Sie jeweils die Gleichung für  als Nullstellenproblem:
	\begin{equation*}
		\tcbhighmath[]{\mathbf{F}_{\mathrm{euler}}(\mathbf{z}) = 0,\quad \mathbf{F}_{\mathrm{trapez}}(\mathbf{z}) = 0}   
	\end{equation*}
	
\end{mybox}


\begin{equation}
 	y^{(i+1)} = y(i) + hf(t_{(i+1)},y^{(i+1)}) 
\end{equation}


und die implizite Trapezregel:
$ y^(i+1) = y(i) + h/2[f(t_i, y^(i) + f(t_i+1,y^(i+1)))] $

wir setzen nun
$ y^{i+1} = y^i + z $

in:

$ y^(i) + z = y^(i) + hf(t_i+1,y^(i) + z) $

und in:

$ y^(i) + z = y^(i) + h/2 [f(t_i, y^(i) + f(t_i+1,y^(i) + z)] $

ein. Formulieren wir nun beides als Nullstellenproblem für  erhalten wir

$ F_euler(z) = z - hf(t_i+1, y^(i) + z) = 0 $

und 

$F_trapez(z) =  z - h/2 [f(t_i, y^(i) + f(t_i+1,y^(i) + z)] = 0$
\begin{mybox}
\textbf{Aufgabe 3. :}
Bestimmen Sie die Jacobi-Matrizen  und  von  und  in Abhängigkeit von, d.h. der Jacobi-Matrix von $f$ bezüglich $y$ .
\end{mybox}


$ D\cdot F_euler(z) = D\cdot z - h\cdot D_(y)\cdot f(t_i+1, y^(i) + z) $

für das implizite Euler-Verfahren und

$ D\cdot F_euler(z) = h/2\cdot [D_(y)\cdot f(t_i+1, y^(i)) +  h\cdot D_(y)f(t_i+1, y^(i) + z)] - D\cdot z $

für das implizite Trapez-Verfahren,

wobei 
\begin{equation}
	D, f =
\begin{bmatrix}
	\frac{\partial f_1 }{\partial y_1} & \frac{\partial f_1 }{\partial y_2} & ... & \frac{\partial f_1 }{\partial y_n} \\
	\frac{\partial f_2 }{\partial y_1} & \frac{\partial f_2 }{\partial y_2} & ... & \frac{\partial f_2 }{\partial y_n} \\
	... & ... & ... & ... \\
	\frac{\partial f_n }{\partial y_1} & \frac{\partial f_n }{\partial y_2} & ... & \frac{\partial f_n }{\partial y_n} 
\end{bmatrix} 
\end{equation}


und $Dz$ =
\begin{equation}
\begin{bmatrix}
	1 & 0 & ... & 0 \\
	0 & 1 & ... & 0 \\
	... & ... & ... & ... \\
	0 & ... & 0 & 1 
\end{bmatrix}  
\end{equation}

\begin{mybox}
	\textbf{Aufgabe 4. :}
	Implementieren Sie die folgenden zwei Routinen. Verwenden Sie fÜr die Jacobi-Matrix $J$ dünnbesetzte
	Matrizen.
\end{mybox}

\begin{figure}[htb]
	\lstinputlisting[style=Matlab-editor]{Matlab_files/Anfangswertproblem/F_euler.m}
\end{figure}

\begin{mybox}
	\textbf{Aufgabe 5. :}
	Implementieren Sie die Löser aufbauend auf den Routinen des letzten Abschnitts und des Newton-Verfahrens aus der Belegarbeit. Als Startwert der Newtoniteration wählen Sie für $z$ den Nullvektor.
\end{mybox}

\begin{figure}[htb]
	\lstinputlisting[style=Matlab-editor]{Matlab_files/Anfangswertproblem/impl_euler.m}
\end{figure}
\section{Anwendung}
\begin{mybox}
	\textbf{Aufgabe 1. :} Formulieren Sie Gleichung (9) als System der Form (11) mit Funktion $f_{\mathrm{chem}}(t; y)$
\end{mybox}



\begin{equation}
	y' = f(t,y) = 
\begin{bmatrix}
	-0.04y_1 + 10^4y_2y_3 \\
	0.04y_1-10^4y_2y_3-3\cdot 10^7y^2_2 \\
	3 \cdot 10^7y^2_2 
\end{bmatrix}  
\end{equation}


mit $ t\in [0,\sim], y(0) = $ 
\begin{equation}
\begin{bmatrix}
	1 \\
	0 \\
	0
\end{bmatrix}
\end{equation}
\begin{mybox}
	\textbf{Aufgabe 2. :}  Implementieren Sie die Funktion als Routine $ d_\mathrm{y} = f_{\mathrm{chem}}(t,y) $
\end{mybox}



\begin{lstlisting}[style=Matlab-editor]
	% dy=f_chem(t,y)
	%--------------------------------------
	% Eingabe:
	% t Zeit t
	% y Vektor y der Größe 3 x 1
	%--------------------------------------
	% Ausgabe:
	% dy Vektor fchem(t; y) der Größe 3 x 1

	function dy = f_chem(t, y)
	a = 0.04;
	b = 10^4;
	c = 10^7;
	dy(1,1) = -a*y(1) + b*y(2)*y(3);
	dy(2,1) =  a*y(1) - b*y(2)*y(3) - 3*c*y(2)^2;
	dy(3,1) =                         3*c*y(2)^2;
	end
\end{lstlisting}


\begin{mybox}
	\textbf{Aufgabe 3. :}	Berechnen Sie die Jacobi-Matrix $ D_yf_chem(t,y) $ von $ f_chem $ bezüglich $ y $
\end{mybox} 

\begin{equation}
	D_yf_chem(t,y) =
\begin{bmatrix}
	-0.04 & 10^4y_3 & 10^4y_2 \\
	0.04 & -10^4y_3-6\cdot 10^7y_2 & -10^4y_2 \\
	0 & 3\cdot 10^7 & 0 
\end{bmatrix}
\end{equation}

\begin{mybox}
	\textbf{Aufgabe 4. :}	Implementieren Sie die Funktion als Routine $ J = f-chem-jac(t,y) $
\end{mybox}
 
\begin{lstlisting}[style=Matlab-editor]
	% J=f_chem_jac(t,y)
	%-----------------------------------------
	% Eingabe:
	% t Zeit t
	% y Vektor y der Größe 3 x 1
	%-----------------------------------------
	% Ausgabe:
	% J Matrix Dyfchem(t; y) der Groeße 3 x 3

	function J = f_chem_jac(t, y)
	a = 0.04;
	b = 10^4;
	c = 10^7;

	J(1,1) = -a;
	J(1,2) =  b*y(3); 
	J(1,3) =  b*y(2);

	J(2,1) =  a;
	J(2,2) = -b*y(3) - 6*c*y(2);
	J(2,3) = -b*y(2);

	J(3,1) =  0;
	J(3,2) =  6*c*y(2);
	J(3,3) =  0;
	end
\end{lstlisting}

